name: mandala
title: Mandala
descr: Vehicle core data manager and data structure.

# Parameters:
#
# name:   short name of class/struct
# title:  text title
# descr:  text description
# units:  text units of measure
# type:   data type
# suffix: make title from parent.title+suffix

# Tree UID contains 4 levels of IDs (11 bits):
#
#   4  classes      2 bits  [sns, ctr, est, cmd]
#   2  types        1 bit   [nav, env]
#   16 subsystems   4 bits
#   16 fields       4 bits
uid_base: 0x1000
uid_bits:
  - 2
  - 1
  - 4
  - 4

# Data flow:
#
#   |sensors|  ->  |est|  ->  |cmd|  ->  |ctr|
#   |-----estimators---|
#                  |--navigators--|
#                             |--controllers-|
#                  |---------telemetry-------|
#                             |----uplink----|

# Parameters are inherited from parent by child fields
inheritance:
  - type
  - units

# defaults:
type: float

# 4 classes
content:
  - name: sns
    title: Sensors
    descr: Read only data sources, measured by sensors from physical parameters.
      Used as inputs to estimators. Never sent through telemetry stream.
    content:
      - name: nav
        content: sns-nav
        title: Navigation
        descr: Sensors used for vehicle navigation and controls.
          Used as input for position and attitude estimators and
          for filters to supply aerodynamic controls.

      - name: env
        content: sns-env
        title: Environment
        descr: Environmental sensors.
          Data used as inputs for filters to estimate vehicle state
          and safety conditions.

  - name: ctr
    title: Controls
    descr: Controls for vehicle drives and servos.
      Published by regulators.
    content:
      - name: nav
        content: ctr-nav
        title: Navigation
        descr: Controls used for vehicle stabilization.
          Data published by controllers for aerodynamic controls.

      - name: env
        content: ctr-env
        title: Environment
        descr: Environmental controls.
          Data generated by internal logic or uplink from GCS.

  - name: est
    title: Estimators
    descr: Current vehicle state.
      Estimated values of sensors and current navigator status.
    content:
      - name: nav
        content: est-nav
        title: Navigation
        descr: Estimated data used for vehicle regulators.
          Filtered sensor data.

      - name: env
        content: est-env
        title: Environment
        descr: Processed data of current vehicle conditions.
          Can be overriden by GCS uplink.

  - name: cmd
    title: Commands
    descr: Commanded values.
      Received from the GCS or provided by navigator as commands for
      regulators.
    content:
      - name: nav
        content: cmd-nav
        title: Navigation
        descr: Commanded values generated by controllers.

      - name: env
        content: cmd-env
        title: System data identifiers
        descr: Special protocols and data wrappers.
        type: byte # void

streams:
  - name: sd
    title: Standard telemetry
    content:
      - state.nav.att.roll: f2
      - state.nav.att.pitch: f2
      - state.nav.att.yaw: f2

      - state.nav.att.p: f1_s10
      - state.nav.att.q: f1_s10
      - state.nav.att.r: f1_s10

      - state.nav.pos.ax: f1_s
      - state.nav.pos.ay: f1_s
      - state.nav.pos.az: f1_s

      - state.nav.status.mag: f1_s001

      - state.nav.air.altitude: f4
      - state.nav.air.airspeed: f2
      - state.nav.air.vspeed: f2
      - state.nav.pos.course: f2

      - state.nav.ctr.rpm: f2
      - state.nav.air.agl: f2
      - state.nav.air.slip: f1_s01
      - state.nav.air.aoa: f1_s01
      - state.nav.air.venergy: f2
      - state.nav.air.ldratio: f2
      - state.nav.air.buo: f2

      - ctr.nav.stab.ail: f1_s001
      - ctr.nav.stab.elv: f1_s001
      - ctr.nav.stab.rud: f1_s001
      - ctr.nav.stab.col: f1_s001

      - ctr.nav.engine.thr: f1_001
      - ctr.nav.engine.prop: f1_s001
      - ctr.nav.engine.choke: f1_001
      - ctr.nav.engine.tune: f1_s001
      - ctr.nav.engine.tvec: f1_s001
      - ctr.nav.engine.rev: bit

      - ctr.nav.wing.flaps: f1_001
      - ctr.nav.wing.airbrk: f1_001
      - ctr.nav.wing.slats: f1_001
      - ctr.nav.wing.sweep: f1_s001
      - ctr.nav.wing.buo: f1_s001

      - ctr.nav.str.rud: f1_s001
      - ctr.nav.str.brake: f1_001
      - ctr.nav.str.gear: bit

      - ctr.nav.ers.launch: bit
      - ctr.nav.ers.rel: bit

      - ctr.env.door.main: bit
      - ctr.env.door.drop: bit

      - ctr.env.sw.starter: bit
      - ctr.env.sw.horn: bit
      - ctr.env.sw.ign1: bit
      - ctr.env.sw.ign2: bit
      - ctr.env.sw.fpump: bit
      - ctr.env.sw.xfeed: bit
